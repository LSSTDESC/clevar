#!/usr/bin/env python
import argparse
from clevar import yaml

if __name__=="__main__":
    # Get command line arguments
    parser = argparse.ArgumentParser()
    parser.add_argument(dest='config_file', help='Configuration yaml file')
    parser.add_argument('-oc','--overwrite-config', dest='overwrite_config', default=False, action='store_true', help='Overwrites config.log.yml file')
    parser.add_argument('-om','--overwrite-files', dest='overwrite_files', default=False, action='store_true', help='Overwrites matching output files')
    args = parser.parse_args()
    # Run function
    match_functions = {'proximity':yaml.match_proximity, 'membership':yaml.match_membership,}
    matching_mode = yaml.read(args.config_file)['matching_mode']
    if matching_mode not in match_functions:
        raise ValueError(f'matching_mode (={matching_mode}) must be in {list(match_functions.keys())}')
    match_functions[matching_mode](args.config_file, args.overwrite_config, args.overwrite_files)
